Most upgrades are automatically applied, but sometimes you may need to update custom templates, or status configuration, to take advantage of new features or improvements. Those changes are discussed here.

The most notable changes in v1.0 revolve around the way [product pricing and currencies are handled](../Products/Price_Types). This has resulted in some breaking changes, detailed below.

[TOC]

## Pricing Changes

The biggest change in Commerce 1.0 compared to v0.12 is how pricing and currencies are handled. 

The short version is that the `price` field (and related `getPrice()` method) on products is deprecated, and instead a more complex and powerful pricing pattern based on Price Types is stored in a new `pricing` field (with related `getPricing($currency)` method). 

There is a lot to say about the new pricing and price types, which [we've done here](../Products/Price_Types). 

While we've tried to keep as much backwards compatibility, that's near impossible with such a massive change. In particular **custom product types** will likely need an update. 

### The price on existing products

When product pricing is loaded for a product that does not yet have _any_ pricing information in the new system, it will take the old `price` value (through the `getPrice` method), and use that as the "regular" price. The old `getPrice` method was not currency aware (at least not fully implemented); so if you enable multiple currencies the integer price is used for each currency (e.g. a price of 1500 will be set as both â‚¬15 and $15). 

There is a chance for custom product types, as well as the resource product type, that this pricing information gets saved; either by the core or a user interaction. When that happens, **the `getPrice` method will no longer be called** when loading the pricing. This means that such products would do best to upgrade their implementation to make use of the price types (even if that means only supporting the regular price and not custom types). [Developers can learn more about the pricing internals here](../Developer/Products/Pricing). The task can be summarised as defining the `getRawPricing` protected function to return an array of `currencyCode => serializedProductPricingInterface`. Please contact support if you need assistance with this.

For the resource product we intend to ship a custom TV type that brings support for all price types into the resource product, likely mid-end April. 

### Prices shown in templates

When it comes to **templates that show product prices**, you should mostly be able of continuing with the templates you used before. Nothing changed for the cart/checkout templates. 

- The `price`/`price_formatted` placeholders you previously used will now hold the **regular** price, as stored in the product pricing, for the currently active currency. This means that for example an active `Sale` price type is NOT taken into account for setting the `price` placeholder. 
- New `price_legacy` and `price_legacy_formatted` placeholders are available which hold the value of the products' `price` field. You should not rely on these (they will be removed in v1.3), but if you encounter a problem with the new pricing and need the old price; these placeholders can be temporarily used. Do reach out to support explaining the problem you had with the new pricing so we can make sure that issue gets resolved.

We're still working on adding the ability to flexibly render sale/quantity pricing, or put more generally the "current applicable price". Expect that to be available by mid-end April.

## [DEV] CountryField.getCountries signature change

The `getCountries` method on the `CountryField` no longer requires you to provide the Commerce class to it.

## [DEV] Grids now escape all columns by default

_This only affects developers of custom modules._

We're now automatically escaping all grid columns by default. This avoids any XSS vulnerabilities from making their way into the dashboard. 

To allow HTML in columns (e.g. to enable links), add `'raw' => true` to your array-style column definition, or use the new way of defining `Column`s with the `raw` option. 

When you've marked a column as raw, it is up to you to make sure any contents in it is properly escaped. A new utility `$this->encode($value)` is now available to grid widgets to help. 

## [DEV] Country dependency introduced breaking change

_This only affects developers of custom modules._

The `CommerceGuys\Intl\Country\CountryRepository` utility that has been available for a while has been updated, which suffered breaking changes. That data has moved to a different package, `CommerceGuys\Addressing\Country\CountryRepository`, which luckily does have the same signatures. 

To prevent such breakage in the future, we've implemented a new `Countries` utility that gives you the same functionality but in a native package that restricts your usage to native classes.


